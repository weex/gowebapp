<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <title>Getting an invoice</title>
  </head>
  <body>
<script src="/js/qrcode.min.js"></script>
<script type="text/javascript">
var payment_hash = "";
var HttpClient = function() {
    this.get = function(aUrl, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() {
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.response);
        }

        anHttpRequest.open( "GET", aUrl, true );
        anHttpRequest.send( null );
    }
}

function myTimer() {
    client.get('http://localhost:3000/check_invoice?payment_hash='+payment_hash, function(response) {
        var obj = JSON.parse(response)
        if (obj.settled === true) {
            myStopFunction();
        }
    });
}

function myStopFunction() {
    clearInterval(myVar);
    // alert('payment complete!');
    document.getElementById("qrcode").innerHTML = "Payment complete!";
}

</script>
<h1>Hi</h2>
  <div id="qrcode"></div>

<script type="text/javascript">
var client = new HttpClient();
client.get('http://localhost:3000/invoice', function(response) {
    var obj = JSON.parse(response)
    // alert(obj.payment_request);
    payment_hash = obj.payment_hash;
    new QRCode(document.getElementById("qrcode"), obj.payment_request);
});
var myVar = setInterval(myTimer, 5000);
</script>

  </body>
</html>



